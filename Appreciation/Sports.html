<!DOCTYPE html>
<html lang="en" ng-app="myApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic & Sports Certificate</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>

    <style>
        :root {
            --primary-blue: #2c3e75;
            --border-blue: #3f51b5;
            --accent-yellow: #ffb100;
            --accent-red: #ef5350;
            --text-gray: #555;
            --bg-purple: #b5b9ff;
        }

        body {
            background-color: var(--bg-purple);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        /* Toolbar */
        .toolbar {
            background: white;
            padding: 12px 25px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
            align-items: center;
            position: sticky;
            top: 10px;
            z-index: 1000;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: none;
            background: var(--border-blue);
            color: white;
            cursor: pointer;
            font-weight: bold;
        }

        select.btn {
            background: #f5f5f5;
            color: #333;
        }

        /* Certificate */
        .certificate {
            width: 950px;
            height: 680px;
            background: white;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 30px 60px rgba(0,0,0,0.3);
        }

        .shape { position: absolute; pointer-events: none; z-index: 1; }
        .red-sq { top: 240px; left: 50px; }
        .bars-r { top: 240px; right: 50px; }
        .bar { width: 65px; height: 10px; background: var(--accent-red); border-radius: 5px; }

        .top-header {
            z-index: 5;
            display: flex;
            justify-content: space-between;
            padding: 10px 50px 0;
        }

        .school-logo, .student-photo {
            background: #eee;
            cursor: pointer;
        }

        .school-logo {
            width: 100px; height: 100px;
            display: flex; align-items: center; justify-content: center;
        }

        .student-photo {
            width: 150px; height: 150px;
            border-radius: 50%;
            overflow: hidden;
            display: inline-block;
        }

        img { width: 100%; height: 100%; object-fit: cover; }

        .school-name {
            flex-grow: 1;
            text-align: center;
            font-size: 28px;
            font-weight: 800;
            color: var(--primary-blue);
            margin-top: 10px;
        }

        .main-content {
            text-align: center;
            margin-top: 10px;
            z-index: 5;
        }

        .title-pill {
            background: var(--accent-yellow);
            font-size: 52px;
            font-weight: 900;
            padding: 5px 60px;
            border-radius: 60px;
            display: inline-block;
        }

        .subtitle {
            letter-spacing: 5px;
            /* margin-bottom: 40px; */
            font-weight: bold;
        }

        .recipient-name {
            font-size: 48px;
            font-weight: 800;
            width: 80%;
            margin: auto;
            border-bottom: 2px solid #ccc;
        }

        .description {
            max-width: 650px;
            margin: 20px auto;
            line-height: 1.6;
        }

        .footer {
            margin-top: auto;
            display: flex;
            justify-content: space-between;
            padding: 0 60px 40px;
            align-items: flex-end;
            z-index: 5;
        }

        .footer-block {
            width: 180px;
            text-align: center;
        }

        .footer-line {
            border-bottom: 2px solid #ccc;
            margin-bottom: 8px;
        }

        /* Medal */
        .medal-box {
            width: 120px;
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .medal-ribbon {
            position: absolute;
            width: 30px;
            height: 35px;
            background: var(--primary-blue);
            top: 110px;
            z-index: -1;
            clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 50% 80%, 0% 100%);
        }

        .ribbon-l { left: 25px; transform: rotate(30deg); }
        .ribbon-r { right: 25px; transform: rotate(-30deg); }

        .medal-gold {
            width: 100px;
            height: 100px;
            /* background: var(--accent-yellow); */
            border-radius: 50%;
            border: 5px solid white;
            box-shadow: 0 0 0 5px var(--accent-yellow);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 80px;
        }
    </style>
</head>

<body ng-controller="myCtrl">

<!-- Toolbar -->
<div class="toolbar">
    <button class="btn" onclick="document.getElementById('photoInput').click()">Upload Photo</button>
    <input type="file" id="photoInput" hidden onchange="previewImage(this,'studentImg')">

    <select class="btn" ng-model="selectedBg" ng-change="changeBackground(selectedBg)">
        <option value="">Default BG</option>
        <option ng-repeat="bg in bgImages" value="{{bg.url}}">{{bg.name}}</option>
    </select>

    <!-- ‚úÖ ICON DROPDOWN -->
    <select class="btn" ng-model="selectedIcon">
        <option ng-repeat="icon in sportsIcons" value="{{icon}}">{{icon}}</option>
    </select>

    <select class="btn" ng-model="positionSelectedIcon">
        <option ng-repeat="icon in positionIcons" value="{{icon}}">{{icon}}</option>
    </select>

    <button class="btn" ng-click="downloadImage(userInfo.FullName)">Save as Image</button>
    <button class="btn" onclick="window.print()">Print</button>
</div>

<div id="poster" class="certificate">
    <div class="shape red-sq">
        <div class="medal-box">
            <div class="medal-gold">{{selectedIcon}}</div>
        </div>
    </div>
    <div class="shape bars-r">
        <div class="medal-box">
            <div class="medal-gold">{{positionSelectedIcon}}</div>
        </div>
    </div>

    <div class="top-header">
        <!-- <div class="school-logo">
            <img ng-src="{{orgInfo.Image}}">
        </div> -->

        <div class="school-name">{{orgInfo.Name}}</div>

        <!-- <div class="student-photo">
            <img id="studentImg" ng-src="{{userInfo.Image}}">
        </div> -->
    </div>

    <div class="main-content">
        <div class="title-pill">CERTIFICATE</div>
        <div class="subtitle">OF APPRECIATION</div>

        <div class="student-photo">
            <img id="studentImg" ng-src="{{userInfo.Image}}">
        </div>

        <p>This certificate is proudly awarded to</p>
        <div class="recipient-name">{{userInfo.FullName}}</div>

        <div class="description">
            For outstanding performance and dedication in sports.
        </div>
    </div>

    <div class="footer">
        <div class="footer-block">
            <div class="footer-line">&nbsp;</div>
            <div><b>Principal Signature</b></div>
        </div>

        <!-- ‚úÖ MEDAL ICON BOUND HERE -->
        <div class="medal-box">
            <div class="medal-ribbon ribbon-l"></div>
            <div class="medal-ribbon ribbon-r"></div>
            <div class="medal-gold">üèÜ</div>
        </div>

        <div class="footer-block">
            <div class="footer-line">Dec 26, 2025</div>
            <div><b>Date</b></div>
        </div>
    </div>
</div>

<script>
function previewImage(input, imgId) {
    const reader = new FileReader();
    reader.onload = e => document.getElementById(imgId).src = e.target.result;
    reader.readAsDataURL(input.files[0]);
}
</script>

<script>
var app = angular.module("myApp", []);
app.controller("myCtrl", function ($scope, $http) {

    const basePath = 'https://schoolvertex.github.io/Pages/Appreciation/images/';
    $scope.bgImages = [
        { name: 'BG 1', url: basePath + 'bg-1.jpg' },
        { name: 'BG 2', url: basePath + 'bg-2.jpg' },
        { name: 'BG 3', url: basePath + 'bg-3.jpg' },
        { name: 'BG 1', url: basePath + 'bg-4.jpg' },
        { name: 'BG 2', url: basePath + 'bg-5.jpg' },
        { name: 'BG 3', url: basePath + 'bg-6.jpg' },
        { name: 'BG 3', url: basePath + 'bg-7.jpg' }
    ];

    // ‚úÖ ICON LIST
    $scope.sportsIcons = ['‚öΩ','üèÄ','üéæ','üé≥','üèè','üèë','üèì','üè∏','ü•ä','ü•ã','üéØ','üé®','üèãÔ∏è‚Äç‚ôÄÔ∏è', 'üö¥‚Äç‚ôÄÔ∏è','‚õπÔ∏è‚Äç‚ôÄÔ∏è','üèä‚Äç‚ôÄÔ∏è','üèÉ‚Äç‚ôÄÔ∏è‚Äç‚û°Ô∏è','üèåÔ∏è‚Äç‚ôÄÔ∏è'];
    $scope.positionIcons = ['ü•á','ü•à','ü•â'];
    
    $scope.selectedIcon = '‚öΩ';
    $scope.positionSelectedIcon = 'ü•á';

    $scope.changeBackground = function (bg) {
        const poster = document.getElementById('poster');
        poster.style.backgroundImage = bg ? `url(${bg})` : '';
        poster.style.backgroundSize = 'cover';
    };

    $scope.downloadImage = function (name) {
        html2canvas(document.getElementById('poster'), { scale: 2, useCORS: true })
            .then(canvas => {
                const link = document.createElement('a');
                link.download = (name || 'certificate') + '.png';
                link.href = canvas.toDataURL();
                link.click();
            });
    };
    // --- Fetching Data and Controller Logic ---
    function getQueryParams() {
        const params = {};
        location.search
            .substr(1)
            .split("&")
            .forEach(function (item) {
                const [key, value] = item.split("=");
                if (key) params[key] = decodeURIComponent(value);
            });
        return params;
    }

    const baseUrl = 'https://api.schoolvertex.com/api';
    // const baseUrl = 'http://localhost:62786/api';

    const query = getQueryParams();
    const userId = query.id;
    const orgId = query.orgid;

    const orgInfoUrl = `${baseUrl}/Organisation/GetInfoForCertificate/${orgId}`;
    $http.get(orgInfoUrl).then(function (response) {
        $scope.orgInfo = response.data;
    });

    const userInfoUrl = `${baseUrl}/User/GetPreviewById/${userId}`;
    $http.get(userInfoUrl).then(function (response) {
        $scope.userInfo = response.data;
    });
});
</script>

</body>
</html>
